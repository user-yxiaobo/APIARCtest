# RNA-seq Analysis Pipeline  

![Workflow Schematic](RNAsnakefile.png)  

## Quick Start Guide  

### 1. Workflow Deployment  

1. **Activate the APIARC environment:**  
   ```bash
   conda activate APIARC
   ```  
2. **Navigate to the RNAProj directory:**  
   ```bash
   cd RNAProj
   ```  

---

### 2. Input File Preparation  

- **Supported formats:**  
  - Compressed (`.fastq.gz`) or uncompressed (`.fastq`) FASTQ files  
  - Both single-end and paired-end sequencing data  
- **Directory structure:**  
  Place all input files in:  
  ```
  RNAProj/fastqfile/
  ```  

---

### 3. Workflow Configuration  

Modify parameters in `config/config.yaml` as follows:  

#### System Configuration  
- **`conda_install_path`**:  
  Path to your Conda installation (e.g., `/home/user/miniconda3`)  

#### Reference Genome  
- **`indexdir`**:  
  Directory containing HISAT2 genome indices  
- **`gfffile`**:  
  Path to gene annotation file (GTF format) for StringTie  

#### Computational Resources  
- **Thread allocation:**  
  ```yaml
  threads:
    trim_galore: 4    # Quality control
    fastp: 5          # Additional QC
    hisat2: 4         # Alignment
    samtools: 4       # SAM/BAM processing
    stringtie: 5      # Transcript assembly
  ```  

#### Picard Parameters  
- **`java_mem`**:  
  JVM maximum heap size (e.g., `-Xmx15g`)  
- **`remove_dups`**:  
  Set to `"true"` to remove duplicate reads  
- **`picarddir`**:  
  Path to Picard installation directory  

#### Sample Metadata  
- **Sample naming convention:**  
  ```yaml
  names:
    mmESC_24h_DOX_1: SRR4032346
    mmESC_24h_DOX_2: SRR4032347
  ```  
- **Experimental design:**  
  ```yaml
  group:
    sample_IDs:
      mmESC_24h_DOX_1: P  # P = Treatment group
      mmESC_no_DOX_1: T   # T = Control group
  ```  

---

### 4. Workflow Execution  

1. **Test configuration (dry run):**  
   ```bash
   snakemake -np
   ```  
2. **Execute pipeline (recommended for production runs):**  
   ```bash
   nohup snakemake --cores <N> > log_rna.txt 2>&1 &
   ```  
   Where `<N>` = number of CPU cores to use  

---

## Example Configuration  

### `config/config.yaml`  
```yaml
conda_install_path: /home/yxiaobo/miniconda3

genome:
  indexdir: "/path/to/hisat2/genome/index"
  gfffile: "/path/to/annotation.gtf"

threads:
  trim_galore: 4
  fastp: 5
  hisat2: 4
  samtools: 4
  stringtie: 5

picard:
  java_mem: "-Xmx15g"
  remove_dups: "true"
  picarddir: "/path/to/picard"

names:
  mmESC_24h_DOX_1: SRR4032346
  mmESC_24h_DOX_2: SRR4032347
  mmESC_no_DOX_1: SRR4032348
  mmESC_no_DOX_2: SRR4032349

group:
  sample_IDs:
    mmESC_24h_DOX_1: P
    mmESC_24h_DOX_2: P
    mmESC_no_DOX_1: T
    mmESC_no_DOX_2: T
```  

---

## Input/Output Specifications  

### Input Files  
Example paired-end input structure:  
```
fastqfile/
├── SRR4032346_1.fastq
├── SRR4032346_2.fastq
├── SRR4032347_1.fastq
└── SRR4032347_2.fastq
```  

### Key Output Files  

#### Alignment Metrics  
- **`hisat2_summary.log`**:  
  Contains alignment statistics for each sample  

#### Differential Expression Results  
- **`gene_count_matrix.csv`**:  
  Gene-level read counts  
- **`result.csv`**:  
  Statistical analysis results including:  
  - log2 fold changes  
  - p-values  
  - Adjusted p-values  

#### Visualization Outputs  
- **`mRNA_volcano.pdf`**:  
  Volcano plot of differentially expressed genes  
- **`sample_PCA.pdf`**:  
  Principal Component Analysis plot  

---

## Complete Output File Reference  

The following table provides a comprehensive list of all output files generated by the pipeline:

| File Name | Directory | Description | Workflow | Tool | Documentation Link |
|-----------|-----------|-------------|----------|------|--------------------|
| sample_1_val_1.fq.gz (paired) | QCfile | Trimmed paired-end reads (file 1) | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_2_val_2.fq.gz (paired) | QCfile | Trimmed paired-end reads (file 2) | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_1_val_1_fastqc.html (paired) | QCfile | FastQC report for file 1 | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_2_val_2_fastqc.html (paired) | QCfile | FastQC report for file 2 | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_1_val_1_fastqc.zip (paired) | QCfile | FastQC data for file 1 | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_2_val_2_fastqc.zip (paired) | QCfile | FastQC data for file 2 | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_1.fastq_trimming_report.txt (paired) | QCfile | Trimming report for file 1 | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_2.fastq_trimming_report.txt (paired) | QCfile | Trimming report for file 2 | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_1_trimmed.fq.gz (single) | QCfile | Trimmed single-end reads | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_1_trimmed_fastqc.html (single) | QCfile | FastQC report for single-end | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_1_trimmed_fastqc.zip (single) | QCfile | FastQC data for single-end | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_1.fastq_trimming_report.txt (single) | QCfile | Trimming report for single-end | RNAProj/CHIPProj | trim_galore | [Link](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) |
| sample_clean_1.fq.gz (paired) | QCfile/fastp/paired | Quality-filtered reads (file 1) | RNAProj | fastp | [Link](https://github.com/OpenGene/fastp) |
| sample_clean_2.fq.gz (paired) | QCfile/fastp/paired | Quality-filtered reads (file 2) | RNAProj | fastp | [Link](https://github.com/OpenGene/fastp) |
| sample.json (paired) | QCfile/fastp/paired | JSON report for paired-end | RNAProj | fastp | [Link](https://github.com/OpenGene/fastp) |
| sample.html (paired) | QCfile/fastp/paired | HTML report for paired-end | RNAProj | fastp | [Link](https://github.com/OpenGene/fastp) |
| sample_clean.fq.gz (single) | QCfile/fastp/single | Quality-filtered single-end reads | RNAProj | fastp | [Link](https://github.com/OpenGene/fastp) |
| sample.json (single) | QCfile/fastp/single | JSON report for single-end | RNAProj | fastp | [Link](https://github.com/OpenGene/fastp) |
| sample.html (single) | QCfile/fastp/single | HTML report for single-end | RNAProj | fastp | [Link](https://github.com/OpenGene/fastp) |
| sample.sam | mapping | Alignment file in SAM format | RNAProj | hisat2 | [Link](http://daehwankimlab.github.io/hisat2/) |
| hisat2_summary.log | mapping | Alignment statistics log | RNAProj | - | - |
| sample_filtered.sam | mapping | Filtered SAM file | RNAProj | - | - |
| sample_sorted.bam | mapping | Sorted BAM file | RNAProj | samtools | [Link](https://www.htslib.org) |
| sample_sorted.bam.bai | mapping | BAM index file | RNAProj | samtools | [Link](https://www.htslib.org) |
| sample.dedup.bam | mapping | Duplicate-marked BAM file | RNAProj | picard | [Link](https://broadinstitute.github.io/picard/) |
| sample.metricsFile | mapping | Picard metrics file | RNAProj | picard | [Link](https://broadinstitute.github.io/picard/) |
| sample.dedup.bam.bai | mapping | Index for deduplicated BAM | RNAProj | samtools | [Link](https://www.htslib.org) |
| sample.transcripts.gtf | expression | Transcript assembly | RNAProj | stringtie | [Link](https://ccb.jhu.edu/software/stringtie/) |
| sample.gene_abundance.txt | expression | Gene abundance estimates | RNAProj | stringtie | [Link](https://ccb.jhu.edu/software/stringtie/) |
| sample_list.txt | expression | GTF file paths and sample names | RNAProj | - | - |
| transcript_count_matrix.csv | DEG | Transcript-level count matrix | RNAProj | - | - |
| gene_count_matrix.csv | DEG | Gene-level count matrix | RNAProj | - | - |
| result.csv | DEG | Differential expression results | RNAProj | - | - |
| UP_gene_names.bed | DEG | Up-regulated gene coordinates | RNAProj | - | - |
| UP_genes_name.csv | DEG | Up-regulated gene list | RNAProj | - | - |
| DOWN_gene_names.bed | DEG | Down-regulated gene coordinates | RNAProj | - | - |
| DOWN_gene_names.csv | DEG | Down-regulated gene list | RNAProj | - | - |
| hista2_result.pdf | picture | HISAT2 alignment results | RNAProj | - | - |
| mRNA_volcano.pdf | picture | Volcano plot of DEGs | RNAProj | - | - |
| sample_boxplot.pdf | picture | Sample distribution boxplot | RNAProj | - | - |
| sample_dist_heatmap.pdf | picture | Sample distance heatmap | RNAProj | - | - |
| sample_PCA.pdf | picture | PCA analysis results | RNAProj | - | - |

---

## Reference Data  
All required reference files are documented in the [reference](/reference/readme.md).  

